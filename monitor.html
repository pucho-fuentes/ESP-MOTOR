<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor IMU ESP32 - Dashboard Profesional</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e5e7eb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }

        h1 {
            color: #38bdf8;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(34, 197, 94, 0.2);
            border-radius: 20px;
            font-size: 0.9em;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(2, 6, 23, 0.8);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(56, 189, 248, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(56, 189, 248, 0.3);
        }

        .card-title {
            color: #38bdf8;
            font-size: 1.2em;
            margin-bottom: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .value-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            border-left: 3px solid;
        }

        .value-display.ax { border-left-color: #ef4444; }
        .value-display.ay { border-left-color: #22c55e; }
        .value-display.az { border-left-color: #3b82f6; }

        .value-label {
            font-weight: 600;
            font-size: 1.1em;
        }

        .value-number {
            font-size: 1.5em;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .chart-large {
            grid-column: 1 / -1;
        }

        .visualization-3d {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .cube-container {
            perspective: 1000px;
            width: 200px;
            height: 200px;
        }

        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s;
        }

        .cube-face {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 2px solid #38bdf8;
            background: rgba(56, 189, 248, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .front  { transform: rotateY(0deg) translateZ(100px); }
        .back   { transform: rotateY(180deg) translateZ(100px); }
        .right  { transform: rotateY(90deg) translateZ(100px); }
        .left   { transform: rotateY(-90deg) translateZ(100px); }
        .top    { transform: rotateX(90deg) translateZ(100px); }
        .bottom { transform: rotateX(-90deg) translateZ(100px); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .stat-item {
            background: rgba(30, 41, 59, 0.5);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: #94a3b8;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #38bdf8;
        }

        .timestamp {
            text-align: center;
            color: #94a3b8;
            font-size: 0.9em;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>游니 Monitor IMU ESP32</h1>
            <div class="status">
                <div class="status-dot"></div>
                <span>Conectado y actualizando</span>
            </div>
        </header>

        <div class="grid">
            <!-- Valores Actuales -->
            <div class="card">
                <div class="card-title">游늵 Aceleraci칩n Actual</div>
                <div class="value-display ax">
                    <span class="value-label">AX (m/s)</span>
                    <span class="value-number" id="ax">0.00</span>
                </div>
                <div class="value-display ay">
                    <span class="value-label">AY (m/s)</span>
                    <span class="value-number" id="ay">0.00</span>
                </div>
                <div class="value-display az">
                    <span class="value-label">AZ (m/s)</span>
                    <span class="value-number" id="az">0.00</span>
                </div>
            </div>

            <!-- Estad칤sticas -->
            <div class="card">
                <div class="card-title">游늳 Estad칤sticas</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Magnitud Total</div>
                        <div class="stat-value" id="magnitude">0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">M치ximo AX</div>
                        <div class="stat-value" id="max-ax">0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">M치ximo AY</div>
                        <div class="stat-value" id="max-ay">0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">M치ximo AZ</div>
                        <div class="stat-value" id="max-az">0.00</div>
                    </div>
                </div>
            </div>

            <!-- Visualizaci칩n 3D -->
            <div class="card">
                <div class="card-title">游 Orientaci칩n 3D</div>
                <div class="visualization-3d">
                    <div class="cube-container">
                        <div class="cube" id="cube">
                            <div class="cube-face front">F</div>
                            <div class="cube-face back">B</div>
                            <div class="cube-face right">R</div>
                            <div class="cube-face left">L</div>
                            <div class="cube-face top">T</div>
                            <div class="cube-face bottom">D</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gr치fica en Tiempo Real -->
            <div class="card chart-large">
                <div class="card-title">游늴 Aceleraci칩n en Tiempo Real</div>
                <div class="chart-container">
                    <canvas id="accelChart"></canvas>
                </div>
            </div>

            <!-- Gr치fica de Barras -->
            <div class="card">
                <div class="card-title">游늵 Comparativa Actual</div>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>

        <div class="timestamp" id="timestamp">칔ltima actualizaci칩n: --</div>
    </div>

    <script>
        // Configuraci칩n de datos
        const maxDataPoints = 50;
        const dataHistory = {
            labels: [],
            ax: [],
            ay: [],
            az: []
        };

        let maxValues = { ax: 0, ay: 0, az: 0 };

        // Configuraci칩n del gr치fico de l칤neas
        const ctxLine = document.getElementById('accelChart').getContext('2d');
        const accelChart = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: dataHistory.labels,
                datasets: [
                    {
                        label: 'AX',
                        data: dataHistory.ax,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'AY',
                        data: dataHistory.ay,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'AZ',
                        data: dataHistory.az,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#e5e7eb' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    }
                },
                animation: {
                    duration: 0
                }
            }
        });

        // Configuraci칩n del gr치fico de barras
        const ctxBar = document.getElementById('barChart').getContext('2d');
        const barChart = new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ['AX', 'AY', 'AZ'],
                datasets: [{
                    label: 'Aceleraci칩n (m/s)',
                    data: [0, 0, 0],
                    backgroundColor: [
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(59, 130, 246, 0.8)'
                    ],
                    borderColor: [
                        '#ef4444',
                        '#22c55e',
                        '#3b82f6'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#e5e7eb' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    },
                    y: {
                        ticks: { color: '#94a3b8' },
                        grid: { color: 'rgba(148, 163, 184, 0.1)' }
                    }
                }
            }
        });

        // Funci칩n para actualizar datos
        async function updateData() {
            try {
                const res = await fetch("/api/latest");
                const data = await res.json();
                
                const ax = parseFloat(data.ax);
                const ay = parseFloat(data.ay);
                const az = parseFloat(data.az);

                // Actualizar valores en pantalla
                document.getElementById("ax").innerText = ax.toFixed(2);
                document.getElementById("ay").innerText = ay.toFixed(2);
                document.getElementById("az").innerText = az.toFixed(2);
                document.getElementById("timestamp").innerText = `칔ltima actualizaci칩n: ${data.timestamp}`;

                // Calcular magnitud
                const magnitude = Math.sqrt(ax*ax + ay*ay + az*az);
                document.getElementById("magnitude").innerText = magnitude.toFixed(2);

                // Actualizar m치ximos
                maxValues.ax = Math.max(maxValues.ax, Math.abs(ax));
                maxValues.ay = Math.max(maxValues.ay, Math.abs(ay));
                maxValues.az = Math.max(maxValues.az, Math.abs(az));
                
                document.getElementById("max-ax").innerText = maxValues.ax.toFixed(2);
                document.getElementById("max-ay").innerText = maxValues.ay.toFixed(2);
                document.getElementById("max-az").innerText = maxValues.az.toFixed(2);

                // Actualizar historial de datos
                const now = new Date().toLocaleTimeString();
                dataHistory.labels.push(now);
                dataHistory.ax.push(ax);
                dataHistory.ay.push(ay);
                dataHistory.az.push(az);

                // Limitar puntos de datos
                if (dataHistory.labels.length > maxDataPoints) {
                    dataHistory.labels.shift();
                    dataHistory.ax.shift();
                    dataHistory.ay.shift();
                    dataHistory.az.shift();
                }

                // Actualizar gr치ficos
                accelChart.update();
                
                barChart.data.datasets[0].data = [ax, ay, az];
                barChart.update();

                // Actualizar cubo 3D
                const cube = document.getElementById('cube');
                const rotateX = ay * 10;
                const rotateY = ax * 10;
                const rotateZ = az * 5;
                cube.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;

            } catch (e) {
                console.error("Error al actualizar datos:", e);
            }
        }

        // Actualizar cada 200ms
        setInterval(updateData, 200);
        updateData(); // Llamada inicial
    </script>
</body>
</html>
